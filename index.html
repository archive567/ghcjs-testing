<header>
<meta charset="utf-8"> <link rel="stylesheet" href="https://tonyday567.github.io/other/lhs.css">
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
</header>
<h1 id="ghcjs-testing"><a href="https://tonyday567.github.com/ghcjs-testing">ghcjs-testing</a></h1>
<p>Minimal ghcjs install and test.</p>
<p>This is old-school web page development: <code>readme.lhs</code> is used to render a html page, and the code below creates some javascript that tweaks said page.</p>
<script language="javascript" src="other/ghcjs-testing.js"></script>
<h1 id="code">code</h1>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="ot">{-# LANGUAGE OverloadedStrings #-}</span>
<span class="kw">import </span><span class="dt">Protolude</span>
<span class="kw">import </span><span class="dt">Vanilla</span>

<span class="kw">import </span><span class="dt">GHCJS.Types</span>
<span class="kw">import </span><span class="dt">GHCJS.Marshal</span>
<span class="kw">import </span><span class="dt">GHCJS.Foreign</span>
<span class="kw">import </span><span class="dt">GHCJS.Foreign.Callback</span>
<span class="kw">import </span><span class="dt">GHCJS.Nullable</span> (maybeToNullable, nullableToMaybe, <span class="dt">Nullable</span>)
<span class="kw">import </span><span class="dt">Data.JSString.Text</span> (textToJSString, textFromJSString, lazyTextToJSString, lazyTextFromJSString)

<span class="ot">main ::</span> <span class="dt">IO</span> ()
main <span class="fu">=</span> <span class="kw">do</span>
    putStrLn (<span class="st">&quot;putStrLn&#39;s go to the console.log&quot;</span><span class="ot"> ::</span> <span class="dt">Text</span>)
    onload <span class="fu">$</span> <span class="kw">do</span>
       alert <span class="st">&quot;window has loaded&quot;</span>
       consoleLog <span class="st">&quot;consolLog is a synonym for putStrLn&quot;</span></code></pre></div>
<h1 id="compiling">compiling</h1>
<p>The recipe below handles the bits and bobs you need to do every re-compile:</p>
<ul class="incremental">
<li>stack build</li>
<li>rendering of the page</li>
<li>optimize (and copy) the js via <a href="http://dl.google.com/closure-compiler">closure</a></li>
</ul>
<pre>
  <code style="white-space: pre-wrap;">
stack build --exec "pandoc -f markdown+lhs -i readme.lhs -t html -o index.html" --exec "pandoc -f markdown+lhs -i readme.lhs -t markdown -o readme.md" --exec "java -jar $(stack path --local-bin)/closure-compiler-v20170124.jar --js_output_file=other/ghcjs-testing.js $(stack path --local-install-root)/bin/ghcjs-testing.jsexe/all.js"
  </code>
</pre>
<h1 id="reference">reference</h1>
<p><a href="https://github.com/ghcjs/ghcjs/wiki/GHCJS-User-Guide">ghcjs user guide</a></p>
<p><a href="https://github.com/ghcjs/ghcjs-base">ghcjs-base</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs">mdn</a></p>
